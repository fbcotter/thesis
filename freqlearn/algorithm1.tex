\begin{algorithm}[tb]
\caption{Locally Invariant Convolutional Layer forward and backward
passes}\label{alg:ch6:inv}
\begin{algorithmic}[1]
\Procedure{GAINLAYERFWD}{$x,\ g_{lp},\ g_1$}
\State $u_{lp},\ u_{1} \gets \DTCWT(x^l, \mbox{nlevels}=1) $ \Comment{$u_{1}$ has 6 orientations and is complex}
  \State \textbf{save} $u_{lp},\ u_{1}$ \Comment{For the backwards pass}
  \State $v_{lp} \gets u_{lp} \conv g_{lp}$ 
  \For{$1\leq k \leq 6$}
  \State \begin{varwidth}[t]{\linewidth}  $v_{1,k} \gets 
      \left( \real{u_{1,k}} \conv \real{g_{1,k}} - \imag{u_{1,k}} \conv \imag{g_{1,k}} \right)\ +$ \par
      \hskip\algorithmicindent \hphantom{abc}$ j\left(\real{u_{1,k}} \conv \imag{g_{1,k}} + \imag{u_{1,k}} \conv \real{g_{1,k}}\right)$;
  \end{varwidth}
  \EndFor
  \State $y \gets \DTCWT^{-1}(v_{lp}, v_{1})$
  \State \textbf{return} $y$
\EndProcedure
\end{algorithmic}\vspace{10pt}
\begin{algorithmic}[1]
  \Procedure{GAINLAYERBWD}{$\dydx{L}{Y},\ g_{lp},\ g_1$}
  \State \textbf{load} $u_{lp},\ u_1$
  \State \textbf{return} $\dydx{L}{x},\ \dydx{L}{A}$
\EndProcedure
\end{algorithmic}
\end{algorithm}

